var NS = {
    name: 'NS',
    version: '1.0.0',
    utilsVersion: '1.0.0',
    SID: function(length){var chars='0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';var len=chars.length;var lenID=typeof(length)?length:5;var str='';for(var i=0;i<lenID;i++){str+=chars.charAt(Math.floor(Math.random()*len));}return str;},
    UID: function(){return Math.ceil(Date.now()/1000)+'-'+NS.SID(3);},
    objectKeys: function(obj){var keys=[];var k;for(k in obj){if(Object.prototype.hasOwnProperty.call(obj,k)){keys.push(k);}}return keys;},
    forIn: function(object,fn){var len=NS.objectKeys(object).length;var i=0;for(var key in object){if(object.hasOwnProperty(key)){var first=(i==0);var last=((i+1)==len);fn(key,object[key],first,last);i++;}}},
    forEach: function(arr,fn){var len=arr.length;for(var i=0;i<len;i++){var first=(i==0);var last=((i+1)==len);fn(arr[i],i,arr,first,last);}},
    map: function(arr,fn){var temp=[];for(var i=0;i<this.length;i++){temp.push(fn(arr[i],i,arr));}return temp;},
    formatString: function(str,args){return str.replace(/\{\d+\}/g,function(text){var value=args[+text.substring(1,text.length-1)];return value===null?'':value;});},
    clone: function(obj,skip,skipFunctions){if(!obj){return obj;}var type=typeof(obj);if(type!=='object'||obj instanceof Date){return obj;}var length;var o;if(obj instanceof Array){length=obj.length;o=new Array(length);for(var i=0;i<length;i++){type=typeof(obj[i]);if(type!=='object'||obj[i]instanceof Date){if(skipFunctions&&type==='function'){continue;}o[i]=obj[i];continue;}o[i]=NS.clone(obj[i],skip,skipFunctions);}return o;}o={};for(var m in obj){if(skip&&skip[m]){continue;}var val=obj[m];var type=typeof(val);if(type!=='object'||val instanceof Date){if(skipFunctions&&type==='function'){continue;}o[m]=val;continue;}o[m]=NS.clone(obj[m],skip,skipFunctions);}return o;},
    contains: function(item,searchValue){if(typeof(item)=='string'){if(item.indexOf(searchValue)!==-1){return true;}}if(Array.isArray(item)){if(item.indexOf(searchValue)!==-1){return true;}}return false;},
    extend: function(target,source,rewrite){if(!target||!source){return target;}if(typeof(target)!=='object'||typeof(source)!=='object'){return target;}if(rewrite===undefined){rewrite=true;}var keys=Object.keys(source);var i=keys.length;while(i--){var key=keys[i];if(rewrite||target[key]===undefined){target[key]=NS.clone(source[key]);}}return target;},
    toQueryString: function(obj,base){var queryString=[];Object.each(obj,function(v,k){if(base)k=base+'['+k+']';var result;switch(typeOf(v)){case'object':result=Object.toQueryString(v,k);break;case'array':var qs={};v.each(function(val,i){qs[i]=val;});result=Object.toQueryString(qs,k);break;default:result=k+'='+encodeURIComponent(v);}if(v!=null)queryString.push(result);});return queryString.join('&');},
    argsToDebugString: function(args){var logs='';for(var i=0;i<arguments.length;i++){var arg=arguments[i];if(arg){if(typeof arg=='object'||Array.isArray(arg)){if(Array.isArray(arg)){logs+='Array('+arg.length+'): \n';}else if(typeof arg=='object'){logs+='Object: \n';}logs+=JSON.stringify(arg,null,'\t');logs+='\n';}else{logs+=arg;}}else{logs+=' '+arg;}}return logs;},
    logDebug: function(){var log=NS.argsToDebugString.apply(this,arguments);console.log(NS.name+': '+log);},
    logInfo: function(str){console.log(NS.name+': '+str);},
    logWarning: function(str){console.warn(NS.name+': '+str);},
    camelToHyphen: function(str){return!str?null:str.replace(/([A-Z])/g,function(g){return('-'+g[0].toLowerCase());}).slice(1);},
    error: function(problem,message){var Co=function(problem,message){if(!problem){throw new Error('missingProblem');}message=message||null;if(problem instanceof Error){this.id=problem.message;this.message=message;}else if(typeof(problem)=='string'){this.id=problem;this.message=message;}else{throw new Error('invalidProblem');}};Co.prototype={throw:function(){throw new Error(this.id);},toString:function(){return JSON.stringify({id:this.id,message:this.message},null,'    ');}};return new Co(problem,message);},
    ErrorBuilder: function(errors){var Co=function(){if(errors){if(!Array.isArray(errors)){throw new Error('invalidParameter');}for(var i=0;i<errors.length;i++){if(!errors[i]||!(errors[i]instanceof ErrorPair)){throw new Error('invalidArrayItem');}}}this.errors=errors||[];};Co.prototype={push:function(errorPair){this.errors.push(errorPair);},remove:function(id){var arr=this.errors;var idx=-1;for(var i=0;i<arr.length;i++){if(arr[i].id==id){idx=i;}}if(idx>-1){arr.splice(idx,1);}},clear:function(){this.errors=[];},toString:function(){return JSON.stringify(this,null,'    ');}};return new Co(errors);},
    SerialFlow: function(result){var Co=function(result){var self=this;self.fnArray=[];self.context={result:(typeof(context)=='object')?result:{}};};Co.prototype.push=function(fn){var args=arguments&&arguments.length&&Array.prototype.slice.call(arguments,1)||[];var self=this;var argArray=args;self.fnArray.push({fn:fn,argArray:argArray});};Co.prototype.run=function(end){var self=this;(function loop(i,argArray){var obj=self.fnArray[i];if(!obj){return end&&end(null,self.context.result);}if(i===0||(Array.isArray(obj.argArray)&&obj.argArray.length>0)){obj.argArray.push(next);obj.fn.apply(self.context,obj.argArray);}else{argArray.push(next);obj.fn.apply(self.context,argArray);}function next(){var args=arguments&&arguments.length&&Array.prototype.slice.call(arguments)||[];var err=args.shift();if(err){return end&&end(err,self.context.result);}if(typeof(setImmediate)=='function'){setImmediate(function(){return loop(++i,args);});}else{return loop(++i,args);}}})(0);};return new Co(result);},
    ajax: function(obj){var xhr=new XMLHttpRequest();var res=null;var json='application/json';xhr.onreadystatechange=function(){if(xhr.readyState===4){if(xhr.status===200){if(obj.header['Accept'===json]){try{res=JSON.parse(xhr.responseText);}catch(err){console.warn('Ajax: Unable to parse success server response to JSON.');obj.error(null,xhr);}}else{res=xhr.responseText;}obj.success(res,xhr);}else{if(obj.header['Accept']===json){try{res=JSON.parse(xhr.responseText);}catch(err){console.warn('Ajax: Unable to parse error server response to JSON.');obj.error(null,xhr);}}else{res=xhr.responseText;}obj.error(res,xhr);}}};xhr.upload.onprogress=function(state){if(state.lengthComputable){var percentage=(state.loaded/state.total)*100;obj.progress(percentage.toFixed(2));}};xhr.onerror=function(){console.warn('Ajax: Unexpected ajax error.');};xhr.open(obj.method,url,true);for(var k in obj.header){var v=obj[k];xhr.setRequestHeader(k,v);}xhr.send(obj.data);},
}
